nuxeo-palette
===========================

This plugin enables to order...

* The content of a folder
* Or a collection
* Or the documents referenced by their IDs stored in a multivalued string fields

...on a grid.

## About 
The project provides a widget template (palette.xhtml) that will create a grid where users can order the thumbnails on a grid using drag and drop.

To use it with Nuxeo Studio, just drop a "template" widget (typically in a "Tab"), add a custom property named "template" and sets its value to "palette.xhtml".

The widget template has default properties that can be overridden to control the size and margin of the palette. The properties are:

* margins_horizontal (default: 10)
* margins_vertical (default: 10) 
* base_dimensions_width (default: 100)
* base_dimensions_heigth (default: 100)
* max_cols (default: 10), for some unknown reason, no value does not seem to work.
* min_cols (default: 10), for some unknown reason, no value does not seem to work.

To change these values, add a custom property with the correct name

Every time the order of a palette is modified by the use:

* The document is saved:
  * If it did not have yet the "palette" facet, it is added
  * This facet comes with a `palette` schema, which is a `COmplex` multivalued, storing information about the items to display in the palette (order, document ID, ...)
* The `PaletteOrderChanged` event is triggered.

The template uses several custom automation operations to get or set the items of the palettes.

The **`Services.GetPaletteItems`** operation is the way to get the items, it renders a JSON String containing  document ids with order, position X and Y, and size. An order 0 means it's a new element, the items are given in the right order. The operation returnsa JSON string built from:

* The children documents if the main document is a Folderish)
* Or the documents of the collection.
* Also, the operation accepts an optionnal `xpath` parameter: If passed and not empty, it is the XPATH of a field for type String , Multivalued, that stores the IDs of existing documents

Example of JSON String generated by the operation:

[{"id":"85d80ab6-1296-4939-a1d3-9d6da1e7eae2","thumburl":"http://localhost:8080/nuxeo/nxthumb/default/85d80ab6-1296-4939-a1d3-9d6da1e7eae2/thumb:thumbnail/Small_ic_looks_one_grey600_48dp.jpg","order":"0"},{"col":"1","size_y":"1","size_x":"1","id":"f7a78334-8813-46b5-ac26-ed8923f9e7b5","row":"1","thumburl":"http://localhost:8080/nuxeo/nxthumb/default/f7a78334-8813-46b5-ac26-ed8923f9e7b5/thumb:thumbnail/Small_ic_looks_two_grey600_48dp.jpg","order":"1"},{"col":"6","size_y":"1","size_x":"1","id":"1358a39f-efb5-47cd-8352-c91273c69c75","row":"1","thumburl":"http://localhost:8080/nuxeo/nxthumb/default/1358a39f-efb5-47cd-8352-c91273c69c75/thumb:thumbnail/Small_ic_looks_3_grey600_48dp.jpg","order":"6"}]

Each time the user orders the palette, the **`Services.SetPaletteItems`** operation is called. It expects a `paletteJSONString` parameter which is JSON String of the elements to store in the `palette:items` complex, multivalued field. This JSON string contains an array of objects, each object having the properties expected by the `palette:items` subfield. This operaiton returns the input document.

Two other operations can be used when the plugin is deployed. They are not called internally and are provided as utility, to avoid your Studio project (or a custom project) to parse the `palette:items` field:

* **`Services.RemovePaletteItem`** remove a document from the palette, given its ID. It accepts the main document as input and two parameters:
  * `docId`, required, is the ID of a document whose reference must be removed from the palette
  * `save`, boolean, is a boolean. If passed and `true` then the input document is saved after the item is removed


* **`Services.GetPaletteItemsDocumentIDs`** returns a JSON String, an array of document IDs. Notice this operaiton does not re-calculate the palette and the position of the items, it just wals the `palette:items` field and builds the JSON string.


## Build-Install
Build Status: [![Build Status](https://qa.nuxeo.org/jenkins/buildStatus/icon?job=Sandbox/sandbox_nuxeo-palette-master)](https://qa.nuxeo.org/jenkins/view/sandbox/job/Sandbox/job/sandbox_nuxeo-palette-master/)

Assuming [`maven`](http://maven.apache.org) (min. 3.2.1) is installed on your computer:

```
# Clone the GitHub repository
cd /path/to/where/you/want/to/clone/this/repository
git clone https://github.com/fvadon/nuxeo-palette
# Compile
cd nuxeo-palette
mvn clean install
```

* The plug-in is in `nuxeo-palette/nuxeo-palette-core/target/`, its name is `nuxeo-palette-core-7.4-{version}.jar`.
* The Marketplace Package is in `nuxeo-palette/nuxeo-palette-mp/target`, its name is `nuxeo-palette-mp-7.4-{version}.zip`.


## Third Party Tools Used
* gridster.js, dsmorse fork: [http://dsmorse.github.io/gridster.js/](http://dsmorse.github.io/gridster.js/). Some modification made to prevent collision where the lib called `root.$` as `$`is Prototype in Nuxeo and not jQuery.


## License
(C) Copyright 2016 Nuxeo SA (http://nuxeo.com/) and others.

[Apache License, Version 2.0](http://www.apache.org/licenses/LICENSE-2.0)

Contributors:

    Frederic Vadon (https://github.com/fvadon)
    Thibaud Arguillere (https://github.com/thibarg)


## About Nuxeo

Nuxeo provides a modular, extensible Java-based [open source software platform for enterprise content management](http://www.nuxeo.com) and packaged applications for Document Management, Digital Asset Management and Case Management. Designed by developers for developers, the Nuxeo platform offers a modern architecture, a powerful plug-in model and extensive packaging capabilities for building content applications.
